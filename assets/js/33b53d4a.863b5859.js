"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[1922],{8050(e,n,s){s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"api/tjs-sqlite.Class.Database","title":"Class: Database","description":"Constructors","source":"@site/docs/api/tjs-sqlite.Class.Database.md","sourceDirName":"api","slug":"/api/tjs-sqlite.Class.Database","permalink":"/docs/api/tjs-sqlite.Class.Database","draft":false,"unlisted":false,"editUrl":"https://github.com/saghul/txiki.js/tree/master/website/docs/api/tjs-sqlite.Class.Database.md","tags":[],"version":"current","frontMatter":{},"sidebar":"apiSidebar","previous":{"title":"tjs:sqlite","permalink":"/docs/api/tjs-sqlite"},"next":{"title":"Interface: IDatabaseOptions","permalink":"/docs/api/tjs-sqlite.Interface.IDatabaseOptions"}}');var r=s(4848),i=s(8453);const a={},l="Class: Database",d={},c=[{value:"Constructors",id:"constructors",level:2},{value:"Constructor",id:"constructor",level:3},{value:"Parameters",id:"parameters",level:4},{value:"dbName",id:"dbname",level:5},{value:"options",id:"options",level:5},{value:"Returns",id:"returns",level:4},{value:"Methods",id:"methods",level:2},{value:"close()",id:"close",level:3},{value:"Returns",id:"returns-1",level:4},{value:"exec()",id:"exec",level:3},{value:"Parameters",id:"parameters-1",level:4},{value:"sql",id:"sql",level:5},{value:"Returns",id:"returns-2",level:4},{value:"loadExtension()",id:"loadextension",level:3},{value:"Parameters",id:"parameters-2",level:4},{value:"file",id:"file",level:5},{value:"entrypoint?",id:"entrypoint",level:5},{value:"Returns",id:"returns-3",level:4},{value:"prepare()",id:"prepare",level:3},{value:"Parameters",id:"parameters-3",level:4},{value:"sql",id:"sql-1",level:5},{value:"Returns",id:"returns-4",level:4},{value:"transaction()",id:"transaction",level:3},{value:"Parameters",id:"parameters-4",level:4},{value:"fn",id:"fn",level:5},{value:"Returns",id:"returns-5",level:4}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"class-database",children:"Class: Database"})}),"\n",(0,r.jsx)(n.h2,{id:"constructors",children:"Constructors"}),"\n",(0,r.jsx)(n.h3,{id:"constructor",children:"Constructor"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"new Database"}),"(",(0,r.jsx)(n.code,{children:"dbName"}),", ",(0,r.jsx)(n.code,{children:"options"}),"): ",(0,r.jsx)(n.code,{children:"Database"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Opens a SQLite database."}),"\n",(0,r.jsx)(n.h4,{id:"parameters",children:"Parameters"}),"\n",(0,r.jsx)(n.h5,{id:"dbname",children:"dbName"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"string"})}),"\n",(0,r.jsxs)(n.p,{children:["The path of the database. Defaults to ",(0,r.jsx)(n.code,{children:":memory:"}),", which\nopens an in-memory database."]}),"\n",(0,r.jsx)(n.h5,{id:"options",children:"options"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"/docs/api/tjs-sqlite.Interface.IDatabaseOptions",children:(0,r.jsx)(n.code,{children:"IDatabaseOptions"})})}),"\n",(0,r.jsx)(n.p,{children:"Options when opening the database."}),"\n",(0,r.jsx)(n.h4,{id:"returns",children:"Returns"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Database"})}),"\n",(0,r.jsx)(n.h2,{id:"methods",children:"Methods"}),"\n",(0,r.jsx)(n.h3,{id:"close",children:"close()"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"close"}),"(): ",(0,r.jsx)(n.code,{children:"void"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Closes the database. No further operations can be performed afterwards."}),"\n",(0,r.jsx)(n.h4,{id:"returns-1",children:"Returns"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"void"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"exec",children:"exec()"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"exec"}),"(",(0,r.jsx)(n.code,{children:"sql"}),"): ",(0,r.jsx)(n.code,{children:"void"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Execute the given SQL statement(s)."}),"\n",(0,r.jsx)(n.h4,{id:"parameters-1",children:"Parameters"}),"\n",(0,r.jsx)(n.h5,{id:"sql",children:"sql"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"string"})}),"\n",(0,r.jsx)(n.p,{children:"The SQL statement(s) that will run."}),"\n",(0,r.jsx)(n.h4,{id:"returns-2",children:"Returns"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"void"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"loadextension",children:"loadExtension()"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"loadExtension"}),"(",(0,r.jsx)(n.code,{children:"file"}),", ",(0,r.jsx)(n.code,{children:"entrypoint?"}),"): ",(0,r.jsx)(n.code,{children:"undefined"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Load an extension from file"}),"\n",(0,r.jsx)(n.h4,{id:"parameters-2",children:"Parameters"}),"\n",(0,r.jsx)(n.h5,{id:"file",children:"file"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"string"})}),"\n",(0,r.jsx)(n.p,{children:"location of the shared library"}),"\n",(0,r.jsx)(n.h5,{id:"entrypoint",children:"entrypoint?"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"string"})}),"\n",(0,r.jsx)(n.p,{children:"entrypoint, if left empty a guess is made by sqlite"}),"\n",(0,r.jsx)(n.h4,{id:"returns-3",children:"Returns"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"undefined"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"prepare",children:"prepare()"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"prepare"}),"(",(0,r.jsx)(n.code,{children:"sql"}),"): ",(0,r.jsx)(n.a,{href:"/docs/api/tjs-sqlite.Interface.IStatement",children:(0,r.jsx)(n.code,{children:"IStatement"})})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Create a prepared statement, to run SQL queries."}),"\n",(0,r.jsx)(n.h4,{id:"parameters-3",children:"Parameters"}),"\n",(0,r.jsx)(n.h5,{id:"sql-1",children:"sql"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"string"})}),"\n",(0,r.jsx)(n.p,{children:"The SQL query that will run."}),"\n",(0,r.jsx)(n.h4,{id:"returns-4",children:"Returns"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"/docs/api/tjs-sqlite.Interface.IStatement",children:(0,r.jsx)(n.code,{children:"IStatement"})})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"transaction",children:"transaction()"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"transaction"}),"(",(0,r.jsx)(n.code,{children:"fn"}),"): ",(0,r.jsx)(n.a,{href:"/docs/api/tjs-sqlite.Interface.ITransaction",children:(0,r.jsx)(n.code,{children:"ITransaction"})})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Wrap the given function so it runs in a ",(0,r.jsx)(n.a,{href:"https://sqlite.org/lang_transaction.html",children:"transaction"}),".\nWhen the (returned) function is invoked, it will start a new transaction. When the function returns,\nthe transaction will be committed. If an exception is thrown, the transaction will be rolled back."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"const ins = db.prepare('INSERT INTO test (txt, int) VALUES(?, ?)');\nconst insMany = db.transaction(datas => {\n    for (const data of datas) {\n        ins.run(data);\n    }\n});\n\ninsMany([\n    [ '1234', 1234 ],\n    [ '4321', 4321 ],\n]);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Transaction functions can be called from inside other transaction functions. When doing so,\nthe inner transaction becomes a ",(0,r.jsx)(n.a,{href:"https://www.sqlite.org/lang_savepoint.html",children:"savepoint"}),". If an error\nis thrown inside of a nested transaction function, the nested transaction function will roll back\nto the state just before the savepoint. If the error is not caught in the outer transaction function,\nthis will cause the outer transaction function to roll back as well."]}),"\n",(0,r.jsx)(n.p,{children:"Transactions also come with deferred, immediate, and exclusive versions:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'insertMany(datas); // uses "BEGIN"\ninsertMany.deferred(datas); // uses "BEGIN DEFERRED"\ninsertMany.immediate(datas); // uses "BEGIN IMMEDIATE"\ninsertMany.exclusive(datas); // uses "BEGIN EXCLUSIVE"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["NOTE: This implementation was mostly taken from ",(0,r.jsx)(n.a,{href:"https://github.com/WiseLibs/better-sqlite3/blob/6acc3fcebe469969aa29319714b187a53ada0934/docs/api.md#transactionfunction---function",children:"better-sqlite3"}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"parameters-4",children:"Parameters"}),"\n",(0,r.jsx)(n.h5,{id:"fn",children:"fn"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"Function"})}),"\n",(0,r.jsx)(n.p,{children:"The function to be wrapped in a transaction."}),"\n",(0,r.jsx)(n.h4,{id:"returns-5",children:"Returns"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"/docs/api/tjs-sqlite.Interface.ITransaction",children:(0,r.jsx)(n.code,{children:"ITransaction"})})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453(e,n,s){s.d(n,{R:()=>a,x:()=>l});var t=s(6540);const r={},i=t.createContext(r);function a(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);